<!DOCTYPE HTML>
<html>
<head>
  <title>‡§Ö‡§®‡•ç‡§µ‡•á‡§∑‡§£‡§Æ‡•ç</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@sanskrit-coders/sanscript@1.1.0/sanscript.min.js"></script>
  <script type="text/javascript" src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>

  <style>
    #svgdiv img { position: absolute; }
    img:hover { filter: brightness(90%); opacity: 0.5; x-background: #e2e2e2; }
    div { border: 1px solid red; }
    svg:hover { x-width: 11%; }
    .st0:hover { fill: red; }
    .st1:hover { fill: yellow; }
    .st2:hover { fill: blue; }
    *[class^="st"]:hover { stroke: green; }

    img[id$="1"] { transform: rotate(10deg); }
    img[id$="2"] { transform: rotate(20deg); }
    img[id$="3"] { transform: rotate(30deg); }
    img[id$="4"] { transform: rotate(40deg); }
    img[id$="5"] { transform: rotate(50deg); }
    img[id$="6"] { transform: rotate(60deg); }
    img[id$="7"] { transform: rotate(70deg); }
    img[id$="8"] { transform: rotate(80deg); }
    img[id$="9"] { transform: rotate(90deg); }

    /* ‚úÖ Celebration UI (inline - no external JS file) */
    #bp26CelebrateOverlay{
      position: fixed; inset: 0;
      display:none; align-items:center; justify-content:center;
      background: rgba(0,0,0,0.35);
      z-index: 10000;
      padding: 20px;
      border: none;
    }
    .bp26CelebrateBox{
      position: relative;
      width: min(460px, 92vw);
      background: #fff;
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.25);
      text-align: center;
      font-family: system-ui, Arial, sans-serif;
      border: 1px solid #eee;
    }
    .bp26Sparkles{
      font-size: 54px;
      line-height: 1.1;
      margin: 8px 0 6px;
      animation: bp26Pop 600ms ease-out both;
    }
    @keyframes bp26Pop{
      0%{ transform: scale(0.6); opacity: 0; }
      100%{ transform: scale(1); opacity: 1; }
    }
    .bp26Btn{
      margin-top: 12px; padding: 10px 14px;
      border-radius: 12px; border: 1px solid #ddd;
      background: #f9fafb; cursor: pointer;
    }
    .bp26Confetti{
      position: fixed;
      top: -12px;
      width: 10px; height: 10px;
      border-radius: 3px;
      z-index: 10001;
      opacity: .95;
      animation: bp26Fall 950ms linear forwards;
      pointer-events: none;
    }
    @keyframes bp26Fall{
      to{ transform: translateY(110vh) rotate(540deg); opacity: 0.9; }
    }
  </style>
</head>

<body>
  <center>
    <h3>
      Find <span style="position:relative;color:tomato;z-index:99" id="tofind"></span>
      ... ‚ùå = <span id="wt">‡•¶</span>
    </h3>
  </center>

  <div id="svgdiv"></div>
  <p></p>

  <!-- ‚úÖ Celebration overlay (inline) -->
  <div id="bp26CelebrateOverlay">
    <div class="bp26CelebrateBox">
      <div class="bp26Sparkles">‚ú®üéâ‚ú®</div>
      <div id="bp26CelebrateTitle" style="font-weight:700;font-size:18px;margin-bottom:6px;">
        Submitted ‚úÖ
      </div>
      <div id="bp26CelebrateSub" style="font-size:14px;color:#374151;">
        Nice work!
      </div>
      <button id="bp26CelebrateClose" class="bp26Btn">Close</button>
    </div>
  </div>

  <script>
    /* ---------------------------
       Celebration (inline)
    --------------------------- */
    function bp26Celebrate({ title="Submitted ‚úÖ", subtitle="Nice work!", score=null } = {}) {
      const overlay = document.getElementById("bp26CelebrateOverlay");
      const t = document.getElementById("bp26CelebrateTitle");
      const s = document.getElementById("bp26CelebrateSub");

      t.textContent = title;
      s.textContent = score === null ? subtitle : `${subtitle}  Score: ${score} ‚ú®`;

      overlay.style.display = "flex";
      bp26BurstConfetti(70);

      setTimeout(() => { overlay.style.display = "none"; }, 2200);
    }

    function bp26BurstConfetti(count=60) {
      for (let i = 0; i < count; i++) {
        const c = document.createElement("div");
        c.className = "bp26Confetti";
        c.style.left = Math.random() * 100 + "vw";
        c.style.width = (6 + Math.random() * 8) + "px";
        c.style.height = (6 + Math.random() * 8) + "px";
        c.style.background = `hsl(${Math.floor(Math.random() * 360)}, 90%, 60%)`;
        c.style.transform = `translateY(0) rotate(${Math.random() * 180}deg)`;
        c.style.animationDuration = (800 + Math.random() * 600) + "ms";
        document.body.appendChild(c);
        setTimeout(() => c.remove(), 6000);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const closeBtn = document.getElementById("bp26CelebrateClose");
      const overlay = document.getElementById("bp26CelebrateOverlay");
      if (closeBtn) closeBtn.addEventListener("click", () => overlay.style.display = "none");
      if (overlay) overlay.addEventListener("click", (e) => {
        if (e.target === overlay) overlay.style.display = "none";
      });
    });
  </script>

  <!-- ‚úÖ Score system: prompt ONCE at start -->
  <script type="module">
    import { bp26Init, reportScore, bp26PromptName } from "./js/bp26-score.js";

    window.reportScore = reportScore;

    // ‚úÖ ask name every launch (start only)
    await bp26PromptName({ force: true });

    // ‚úÖ set game id
    bp26Init({ game: "bp26-Game3" });

    // optional: write 0 history so user appears (safe)
    try { await reportScore(0); } catch(e) { console.warn("initial 0 submit failed", e); }
  </script>

  <script>
    // ‚úÖ CHANGE THIS to your real home page
    const HOME_URL = "./index.html";

    let timer = null;

    let secs = 0;
    function countSecs() { secs++; }

    const wpp = 15;

    const tlang = [];
    tlang[1] = "itrans";
    tlang["gu"] = "gujarati";
    tlang["ka"] = "kannada";
    tlang["be"] = "bengali";
    tlang["ml"] = "malayalam";
    tlang["te"] = "telugu";
    tlang["ta"] = "tamil";

    const urlParams = new URLSearchParams(window.location.search);
    let t = urlParams.get("t");
    if (!t) t = 1;

    let set = urlParams.get("s");
    if (!set || isNaN(set)) set = 0;

    let tofind = parseInt((Math.random() * 100) % wpp);
    let wt = 1;

    let gameFinished = false;

    function computeScore(attempts, seconds) {
      const wrongAttempts = Math.max(0, attempts - 1);
      const score = 100 - (wrongAttempts * 5) - Math.floor(seconds / 2);
      return Math.max(0, Math.floor(score));
    }

    async function submitScoreNow(finalScore) {
      if (typeof window.reportScore !== "function") {
        console.warn("[BP26] reportScore() not found. Check ./js/bp26-score.js path.");
        return { username: "unknown" };
      }
      const res = await window.reportScore(finalScore);
      console.log("[BP26] ‚úÖ Score submitted:", finalScore);
      return res;
    }

    async function chk(id) {
      if (gameFinished) return;

      if (String(id) === String(tofind)) {
        document.getElementById(id).style.background = "green";
        document.getElementById(id).style.border = "1px solid green";

        const attempts = wt;
        const finalScore = computeScore(attempts, secs);

        gameFinished = true;

        // ‚úÖ stop timer immediately
        if (timer) clearInterval(timer);

        // ‚úÖ submit score
        let res = { username: "unknown" };
        try { res = await submitScoreNow(finalScore); } catch(e) { console.warn("submit failed", e); }

        // ‚úÖ celebration (user WILL see it)
        bp26Celebrate({
          title: "Game Finished ‚úÖ",
          subtitle: `Great job, ${res.username}!`,
          score: finalScore
        });

        // ‚úÖ after a moment, go HOME (NOT restart)
        setTimeout(() => {
          window.location.href = HOME_URL;
        }, 1400);

      } else {
        document.getElementById(id).style.background = "pink";
        document.getElementById(id).style.border = "1px dotted red";
        $("#wt").html(Sanscript.t(String(wt++), "itrans", "devanagari"));
      }
    }

    window.chk = chk;

    document.addEventListener("DOMContentLoaded", function () {
      secs = 0;
      if (timer) clearInterval(timer);
      timer = setInterval(countSecs, 1000);
      countSecs();

      const lnk = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ6CFR_0gDsZl-lmwLFWmtdXMXYGVEHGJ8fvBu2_5wvbEl9L-4Yr0ugI0TFTTdvtLlMTRmLnCIJ5FBF/pub?gid=0&single=true&output=csv";
      Papa.parse(lnk, { download: true, header: true, complete: populateWlist });
    });

    function populateWlist(fildat) {
      const fullist = fildat.data || [];
      if (set > fullist.length / wpp) set = 0;

      const openmojibase = "https://openmoji.org/data/color/svg/";
      const image = [];
      const words = [];
      const aud = [];
      let imglnk = "";

      for (let i = 0; i < wpp; i++) {
        const row = fullist[(set * wpp) + i];
        if (!row) continue;

        words.push(row.padam);

        const im = row["Imaage link"] || "";
        if (im.length === 4 || im.length === 5) imglnk = openmojibase + im + ".svg";
        else imglnk = im;

        image.push(imglnk);
        aud.push(row["alnk"]);
      }

      $("#tofind").html(
        `<button id="${tofind}" onclick='musicelements[this.id].play()'>üîä</button> ${words[tofind]}`
      );

      if (t != 0 && tlang[t]) {
        $("#tofind").append(" = " + Sanscript.t(words[tofind], "devanagari", tlang[t]));
      }

      for (let i = 0; i < words.length; i++) {
        const positiontop = (Math.random() * (window.visualViewport.height - 121)) + 30;
        const positionright = Math.random() * (window.visualViewport.width - 121);
        const zindex = i;

        const img = `
          <img id="${i}" src="${image[i]}"
            style="top:${positiontop}px; right:${positionright}px; z-index:${zindex};"
            width="121" onclick="chk(this.id)">
        `;

        document.getElementById("svgdiv").innerHTML +=
          img + `<audio id="${i}" src="${aud[i]}" preload="auto"></audio>`;
      }

      window.musicelements = document.getElementsByTagName("audio");

      try { window.musicelements[tofind].play(); }
      catch (e) { console.warn("[BP26] autoplay blocked", e); }
    }
  </script>
</body>
</html>
