<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>à¤¶à¤¤.à¤®à¥ zat.am</title>

    <!-- font-awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"
    />

    <!-- styles -->
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <!-- Leaderboard (Aggregate Top 3 preview) -->
    <div class="leaderboard-container">
      <a class="leaderboard-btn" href="leaderboard.html">ğŸ† Leaderboard</a>

      <div class="leaderboard-panel">
        <div class="lb-title">ğŸ† Top Players</div>

        <div class="lb-item gold">
          ğŸ¥‡ <span id="p1Name">â€”</span>
          <span id="p1Score">0</span>
        </div>

        <div class="lb-item silver">
          ğŸ¥ˆ <span id="p2Name">â€”</span>
          <span id="p2Score">0</span>
        </div>

        <div class="lb-item bronze">
          ğŸ¥‰ <span id="p3Name">â€”</span>
          <span id="p3Score">0</span>
        </div>

        <a href="leaderboard.html" class="lb-link">View Full Leaderboard â†’</a>
      </div>
    </div>

    <section class="menu">
      <!-- title -->
      <div class="title">
        <h2>à¤¸à¤‚à¤¸à¥à¤•à¥ƒà¤¤à¤­à¤¾à¤°à¤¤à¥€</h2>
        <div class="underline"></div>
      </div>

      <!-- filter buttons (app.js fills these) -->
      <div class="btn-container"></div>

      <!-- menu items -->
      <div class="section-center"></div>
    </section>

    <!-- your existing portal JS -->
    <script src="app.js"></script>

    <!-- âœ… inject Scoring + Contest buttons -->
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        setTimeout(() => {
          const btnContainer = document.querySelector(".btn-container");
          if (!btnContainer) return;

          function addTab(id, text, href) {
            if (btnContainer.querySelector(`[data-id="${id}"]`)) return;
            const a = document.createElement("a");
            a.className = "filter-btn";
            a.setAttribute("data-id", id);
            a.href = href;
            a.textContent = text;
            btnContainer.appendChild(a);
          }

          addTab("scoring", "ğŸ¯ Scoring Games", "scoring.html");
          addTab("contest", "ğŸ† Contest ", "contest.html");
        }, 0);
      });
    </script>

    <!-- Firebase Top 3 loader -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
      import {
        getFirestore,
        collection,
        query,
        orderBy,
        limit,
        getDocs
      } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyA5-cHjL5iL8Arjqv2Pt2WecT8RTLw3Weg",
        authDomain: "zatam-leaderboard.firebaseapp.com",
        projectId: "zatam-leaderboard",
        storageBucket: "zatam-leaderboard.firebasestorage.app",
        messagingSenderId: "1053027312775",
        appId: "1:1053027312775:web:43325a831ab077d017c422",
        measurementId: "G-KP78X2DN6L"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      async function loadTop3() {
        const q = query(
          collection(db, "scores_aggregate"),
          orderBy("totalScore", "desc"),
          limit(3)
        );

        const snap = await getDocs(q);
        const top = [];
        snap.forEach((d) => top.push(d.data()));

        const p1 = top[0] || { playerName: "â€”", totalScore: 0 };
        const p2 = top[1] || { playerName: "â€”", totalScore: 0 };
        const p3 = top[2] || { playerName: "â€”", totalScore: 0 };

        document.getElementById("p1Name").textContent = p1.playerName || "â€”";
        document.getElementById("p1Score").textContent = p1.totalScore ?? 0;

        document.getElementById("p2Name").textContent = p2.playerName || "â€”";
        document.getElementById("p2Score").textContent = p2.totalScore ?? 0;

        document.getElementById("p3Name").textContent = p3.playerName || "â€”";
        document.getElementById("p3Score").textContent = p3.totalScore ?? 0;
      }

      loadTop3();
    </script>
  </body>
</html>
